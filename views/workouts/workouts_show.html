<!doctype html>
<html>
  <head>
    {{ template "head" }}
    <script src="/assets/leaflet.js"></script>
    <link href="/assets/leaflet.css" rel="stylesheet" />
  </head>
  <body>
    {{ template "header" . }}
    <div class="content">
      <div class="gap-4">
        <span class="actions">
          <form action="/workouts/edit/{{ .workout.ID }}" method="get">
            <button>
              <a class="icon-pen-to-square"></a>
            </button>
          </form>
          <form action="/workouts/{{ .workout.ID }}" method="post">
            <button name="action" value="refresh">
              <a class="icon-arrows-rotate"></a>
            </button>
          </form>
          <form onsubmit="return false">
            <button onclick="openModal('modalConfirmDelete')">
              <a class="icon-trash"></a>
            </button>
          </form>

          <div id="modalConfirmDelete" class="modal">
            <div class="window">
              <div class="flex justify-end p-2">
                <button
                  onclick="closeModal('modalConfirmDelete')"
                  type="button"
                  class="close-modal"
                >
                  <a class="icon-xmark"></a>
                </button>
              </div>

              <div class="modal-content">
                <h3>Are you sure you want to delete this workout?</h3>
                <div class="flex">
                  <form method="post" action="/workouts/{{ .workout.ID }}">
                    <button name="action" value="delete" class="confirm">
                      Continue
                    </button>
                  </form>
                  <form onsubmit="return false">
                    <button
                      onclick="closeModal('modalConfirmDelete')"
                      class="cancel"
                    >
                      Cancel
                    </button>
                  </form>
                </div>
              </div>
            </div>
          </div>
        </span>

        <h2
          class="icon-{{ .workout.Type | FAIconClass }} icon-baseline icon-space-sm icon-before
                    icon-{{ .workout.Type | FAIconName }}"
        >
          {{ .workout.Name | html }}
        </h2>
      </div>
      <div class="grid grid-cols-2 gap-4">
        <div
          id="map"
          class="border-2 border-black rounded-xl"
          style="height: 600px"
        >
          <script>
            let points = [
              {{- range $idx, $pt := .workout.Data.Points }}
              {{  if $idx  }},{{  end -}}
              { "lat": {{  $pt.Lat  }}, "lng": {{  $pt.Lng -}}, "title": {{  $pt.Title  }} }
              {{- end  }}
            ];
            let center = [{{  .workout.Data.Center.Lat  }}, {{  .workout.Data.Center.Lng  }}];
          </script>
          <script src="/assets/map.js"></script>
        </div>
        <div class="grid grid-cols-1">
          {{ if .workout.Notes }}
          <div class="inner-form text-sm h-16 hover:h-fit overflow-hidden">
            <div class="flex">
              <div
                class="font-bold rounded-xl icon-solid icon-baseline icon-space-sm icon-before icon-quote-left"
              ></div>
              {{ .workout.Notes }}
            </div>
          </div>
          {{ end }}
          <div class="grid grid-cols-2 gap-4">
            <div class="inner-form">
              <table class="workout-info">
                <tbody>
                  <tr>
                    <td
                      class="icon-regular icon-baseline icon-space-sm icon-before icon-calendar"
                    ></td>
                    <th>Date</th>
                    <td>
                      <span title="{{ .workout.Date | LocalDate }}">
                        {{ .workout.Date | RelativeDate }}
                      </span>
                    </td>
                  </tr>
                  <tr>
                    <td
                      class="icon-solid icon-baseline icon-space-sm icon-before icon-map-location-dot"
                    ></td>
                    <th>Location</th>
                    <td>
                      {{ template "snippet_location" .workout.Data.Address }}
                    </td>
                  </tr>
                  <tr>
                    <td
                      class="icon-solid icon-baseline icon-space-sm icon-before icon-dumbbell"
                    ></td>
                    <th>Type</th>
                    <td>{{ .workout.Type }}</td>
                  </tr>
                  <tr>
                    <td
                      class="icon-regular icon-baseline icon-before icon-space-sm icon-clock"
                    ></td>
                    <th>Total duration</th>
                    <td>{{ .workout.Data.TotalDuration }}</td>
                  </tr>
                  <tr>
                    <td
                      class="icon-solid icon-baseline icon-space-sm icon-before icon-road"
                    ></td>
                    <th>Total distance</th>
                    <td>{{ .workout.Data.TotalDistance | HumanDistance }}</td>
                  </tr>
                  <tr>
                    <td
                      class="icon-solid icon-baseline icon-space-sm icon-before icon-gauge"
                    ></td>
                    <th>Average speed</th>
                    <td>{{ .workout.Data.AverageSpeed | HumanSpeed }}</td>
                  </tr>
                  <tr>
                    <td
                      class="icon-solid icon-baseline icon-space-sm icon-before icon-gauge"
                    ></td>
                    <th>Average tempo</th>
                    <td>{{ .workout.Data.AverageSpeed | HumanTempo }}</td>
                  </tr>
                  <tr>
                    <td
                      class="icon-solid icon-baseline icon-space-sm icon-before icon-gauge-high"
                    ></td>
                    <th>Max speed</th>
                    <td>{{ .workout.Data.MaxSpeed | HumanSpeed }}</td>
                  </tr>
                  <tr>
                    <td
                      class="icon-solid icon-baseline icon-space-sm icon-before icon-hourglass"
                    ></td>
                    <th>Time pauzed</th>
                    <td>{{ .workout.Data.PauzeDuration }}</td>
                  </tr>
                  <tr>
                    <td
                      class="icon-solid icon-baseline icon-space-sm icon-before icon-mountain"
                    ></td>
                    <th>Min elevation</th>
                    <td>{{ .workout.Data.MinElevation | HumanDistance }}</td>
                  </tr>
                  <tr>
                    <td
                      class="icon-solid icon-baseline icon-space-sm icon-before icon-mountain"
                    ></td>
                    <th>Max elevation</th>
                    <td>{{ .workout.Data.MaxElevation | HumanDistance }}</td>
                  </tr>
                  <tr>
                    <td
                      class="icon-solid icon-baseline icon-space-sm icon-before icon-chevron-up"
                    ></td>
                    <th>Total up</th>
                    <td>{{ .workout.Data.TotalUp | HumanDistance }}</td>
                  </tr>
                  <tr>
                    <td
                      class="icon-solid icon-baseline icon-space-sm icon-before icon-chevron-down"
                    ></td>
                    <th>Total down</th>
                    <td>{{ .workout.Data.TotalDown | HumanDistance }}</td>
                  </tr>
                </tbody>
              </table>
            </div>
            <div class="inner-form">
              <table class="workouts-list">
                <thead>
                  <tr>
                    <th></th>
                    <th>KM</th>
                    <th>Duration</th>
                    <th>Speed</th>
                    <th>Tempo</th>
                  </tr>
                </thead>
                <tbody>
                  {{ range .workoutStatistics }}
                  <tr>
                    <td>
                      {{ if .IsWorst }}
                      <span
                        class="icon-baseline icon-space-sm text-orange-600 icon-solid icon-after icon-arrow-down-long"
                      ></span
                      >{{ end }} {{ if .IsBest }}
                      <span
                        class="icon-baseline icon-space-sm text-green-500 icon-solid icon-after icon-arrow-up-long"
                      ></span
                      >{{ end }}
                    </td>
                    <td class="text-center">{{ .Kilometer }}</td>
                    <td>{{ .Duration }}</td>
                    <td>{{ .Speed | HumanSpeed }}</td>
                    <td>{{ .Speed | HumanTempo }}</td>
                  </tr>
                  {{ end }}
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
    </div>

    {{ template "footer" }}
  </body>
</html>
