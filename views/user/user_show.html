<!doctype html>
<html>
  <head>
    {{ template "head" }}
  </head>
  <body>
    {{ template "header" . }}
    <div class="content">
      <h2
        class="icon-solid icon-baseline icon-space-sm icon-before icon-chart-line"
      >
        Dashboard for {{ .user.Username | html }}
      </h2>

      {{ template "stats_records_total" .UserStatistics.Total }}

      <div class="grid grid-cols-2 gap-4">
        <div>
          {{ if len .workouts }}
          <div class="inner-form">
            {{ template "stats_records_running" .UserStatistics.Records }}
          </div>
          {{ end }}
        </div>
        <div class="inner-form" id="calendar"></div>
        <script src="{{ RouteFor `assets` }}/dist/fullcalendar.min.js"></script>
        <script>
          document.addEventListener("DOMContentLoaded", function () {
            var calendarEl = document.getElementById("calendar");
            var calendar = new FullCalendar.Calendar(calendarEl, {
              timeZone: Intl.DateTimeFormat().resolvedOptions().timeZone,
              initialView: "dayGridMonth",
              locale: Intl.DateTimeFormat().resolvedOptions().locale,
              firstDay: 1,
              aspectRatio: 2,
              eventContent: function(arg) {
                let eventSpan = document.createElement('div')

                eventSpan.innerHTML = arg.event.title
                eventSpan.classList.add(
                  "px-2", "icon-baseline", "icon-before", "icon-space-sm", "overflow-hidden",
                  arg.event.extendedProps.iconClass, arg.event.extendedProps.iconName
                )

                return { domNodes: [ eventSpan ] }
              },
              events: [
                {{ range $idx, $w := .workouts }}
                {
                  title: "{{ $w.Type }}",
                  start: "{{ $w.Date | LocalDate }}",
                  url: "/workouts/{{ $w.ID }}",
                  display: 'block',
                  extendedProps: {
                    iconClass: "icon-{{ $w.Type | FAIconClass }}",
                    iconName: "icon-{{ $w.Type | FAIconName }}",
                  },
                },
                {{ end }}
              ],
            });
            calendar.render();
          });
        </script>
      </div>
      <div class="inner-form">
        <h3
          class="icon-solid icon-baseline icon-space-sm icon-before icon-users"
        >
          Other users
        </h3>

        <div class="flex flex-wrap gap-5">
          {{ range .users }} {{ if ne .ID $.user.ID }}
          <a
            class="rounded-xl py-2 px-5 bg-neutral-700 hover:bg-neutral-600 border border-neutral-500"
            href="{{ RouteFor `user-show` .ID }}"
            >{{ .Username | html }}</a
          >
          {{ end }} {{ end }}
        </div>
      </div>
      <div class="inner-form">
        <h3
          class="icon-solid icon-baseline icon-space-sm icon-before icon-dumbbell"
        >
          Recent activity
        </h3>
        <div class="flex gap-5">
          {{ range .recentWorkouts }} {{ template "workout_item" . }} {{ end }}
        </div>
      </div>
    </div>

    {{ template "footer" . }}
  </body>
</html>
