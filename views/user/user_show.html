<!doctype html>
<html>
  <head>
    {{ template "head" }}
  </head>
  <body>
    {{ template "header" . }}
    <div class="content">
      <h2 class="{{ IconFor `dashboard` }}">
        Dashboard for {{ .user.Name | html }}
      </h2>

      {{ template "stats_records_total" .UserStatistics.Total }}

      <div class="grid grid-cols-2 gap-4">
        <div>
          {{ if len .workouts }}
          <div class="inner-form">
            {{ template "stats_records_running" .UserStatistics.Records }}
          </div>
          {{ end }}
        </div>
        <div class="inner-form" id="calendar"></div>
        <script src="{{ RouteFor `assets` }}/dist/fullcalendar.min.js"></script>
        <script>
          document.addEventListener("DOMContentLoaded", function () {
            var calendarEl = document.getElementById("calendar");
            var calendar = new FullCalendar.Calendar(calendarEl, {
              timeZone: Intl.DateTimeFormat().resolvedOptions().timeZone,
              initialView: "dayGridMonth",
              locale: Intl.DateTimeFormat().resolvedOptions().locale,
              firstDay: 1,
              aspectRatio: 2,
              eventContent: function(arg) {
                let eventSpan = document.createElement('div')

                eventSpan.innerHTML = arg.event.title
                eventSpan.classList.add(
                  "px-2", "overflow-hidden", ...arg.event.extendedProps.iconClass.split(" "),
                )

                return { domNodes: [ eventSpan ] }
              },
              events: [
                {{ range .workouts }}
                {
                  title: "{{ .Type }}",
                  start: "{{ .Date | LocalDate }}",
                  url: "/workouts/{{ .ID }}",
                  display: 'block',
                  extendedProps: {
                    iconClass: "{{ IconFor .Type }}",
                  },
                },
                {{ end }}
              ],
            });
            calendar.render();
          });
        </script>
      </div>
      {{ if .users }}
      <div class="inner-form">
        <h3 class="{{ IconFor `users` }}">Other users</h3>

        <div class="flex flex-wrap gap-5">
          {{ range .users }} {{ if ne .ID $.user.ID }}
          <a
            class="rounded-xl py-2 px-5 bg-neutral-700 hover:bg-neutral-600 border border-neutral-500"
            href="{{ RouteFor `user-show` .ID }}"
            >{{ .Name | html }}</a
          >
          {{ end }} {{ end }}
        </div>
      </div>
      <div class="inner-form">
        <h3 class="{{ IconFor `workout` }}">Recent activity</h3>
        <div class="flex flex-wrap justify-center">
          {{ range .recentWorkouts }}{{ template "workout_item" . }}{{ end }}
        </div>
      </div>
    </div>
    {{ end }} {{ template "footer" . }}
  </body>
</html>
